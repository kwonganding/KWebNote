<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å†’æ³¡æ’åº-Vueå¯è§†åŒ–å†’æ³¡åŠ¨ç”»</title>
  <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
</head>

<body>
  <div id="app">
    <h1>å†’æ³¡æ’åº</h1>
    <!-- å‚æ•°åŒºåŸŸ -->
    <div class="para">
      <span>æ’åºåˆ—è¡¨(ç©ºæ ¼éš”å¼€)ï¼š</span><input type="text" v-model="sortArr">
      <span>è‡ªåŠ¨æ‰§è¡Œé—´éš”(ms)ï¼š</span><input type="number" v-model="speed">
    </div>
    <div class="control">
      <button v-on:click="initSortItems">ğŸ”é‡ç½®</button>
      <button v-on:click="play">â–¶ï¸å•æ­¥æ‰§è¡Œ</button>
      <button v-on:click="start">è‡ªåŠ¨æ‰§è¡Œ</button>
      <button v-on:click="stop">æš‚åœ</button>
    </div>
    <!-- æ³¡æ³¡ -->
    <transition-group tag="ul" name="sort" class="sort">
      <li v-for="item in sortItems" :key="item.value"
        :style="{'backgroundColor':item.color,width:item.size,height:item.size,'line-height':item.size}">{{item.value}}
      </li>
    </transition-group>
  </div>

  <style>
    #app {
      margin: 10px 20px;
    }

    .para {
      display: grid;
      grid-template-columns: 160px 300px;
      row-gap: 10px;
    }

    .control {
      margin: 20px;
      margin-left: 100px;
    }

    .control button {
      padding: 5px 15px;
      margin: 0 5px;
    }

    .sort {
      list-style-type: none;
      margin: 20px 0;
      padding: 0px;
    }

    .sort li {
      border: 1px solid #e2dcdc;
      padding: 10px;
      margin: 5px;
      border-radius: 50%;
      display: inline-block;
      vertical-align: middle;
      text-align: center;
      font-size: 21px;
      transition: all 0.7s ease-in-out;
    }
  </style>

  <script>
    const bubbleColor = {
      default: '#f6f2f2',
      inprocess: '#f1cc9f',
      completed: 'mediumspringgreen'
    }
    function resetColor(items, color = bubbleColor.default) {
      items.forEach(item => {
        if (item.color != bubbleColor.completed)
          item.color = color;
      });
    }

    //å®šä¹‰ä¸€ä¸ªæ’åºå¯¹è±¡ï¼ŒåŒ…è£…å¾…æ’åºå…ƒç´ 
    function SortItem(n) {
      this.value = n;
      this.size = 30 + n + 'px';  //æ³¡æ³¡å¤§å°ï¼Œåˆè¯•å¤§å°30px
      this.color = bubbleColor.default;
    }
    //ç”Ÿæˆæ’åºå¯¹è±¡é›†åˆï¼Œå‚æ•°ä¸ºæ’åºå…ƒç´ å­—ç¬¦ä¸²ï¼Œå¦‚â€œ9 100 6 17 3 1â€
    function generateSortItems(arrStr) {
      let arrItems = [];
      let arr = arrStr.trim().split(' ');
      for (let i = 0; i < arr.length; i++) {
        arrItems[i] = new SortItem(window.parseInt(arr[i]));
      }
      return arrItems;
    }

    //è¿­ä»£å™¨å®ç°æ’åºæ­¥éª¤çš„æ‹†åˆ†
    function* generateSortFunc(items) {
      const len = items.length;
      for (let i = 0; i < len - 1; i++) {
        for (let j = 0; j < len - i - 1; j++) {
          //è¿­ä»£å™¨è¿”å›çš„æ˜¯ä¸€ä¸ªï¼ˆé—­åŒ…ï¼‰å‡½æ•°ï¼Œä¸ºæ¯ä¸€ä¸ªæ’åºæ­¥éª¤
          yield () => {
            //æ‰§è¡Œæ’åºå‰é‡ç½®æ³¡æ³¡é¢œè‰²
            resetColor(items);
            //æ­£åœ¨æ’åºçš„æ³¡æ³¡å…ƒç´ é«˜äº®
            items[j].color = bubbleColor.inprocess;
            items[j + 1].color = bubbleColor.inprocess;
            if (items[j].value > items[j + 1].value) {
              [items[j], items[j + 1]] = [items[j + 1], items[j]];
            }
          }
        }
        //å®Œæˆä¸€è½®æ’åºï¼Œæœ«å°¾æ³¡æ³¡å…ƒç´ æ ‡è®°ä¸ºå®Œæˆæ€é¢œè‰²
        items[len - i - 1].color = bubbleColor.completed;
      }
    }

    let app = new Vue({
      el: "#app",
      data: {
        sortArr: '9 100 6 17 3 1',
        speed: 2000,
        isAutoPlay: false,
        sortItems: null, //æ’åºå¯¹è±¡é›†åˆ
        sortFunc: null, //æ’åºè¿­ä»£å™¨
      },
      methods: {
        //åˆå§‹åŒ–æ’åºå¯¹è±¡é›†åˆ
        initSortItems: function () {
          this.stop();
          this.sortItems = generateSortItems(this.sortArr);
          this.sortFunc = generateSortFunc(this.sortItems);
        },
        //å•æ­¥æ‰§è¡Œ
        play() {
          let next = this.sortFunc.next();
          if (next.done) {
            this.sortItems.forEach(item => item.color = bubbleColor.completed);
            this.stop();
          }
          else
            next.value();
        },
        //å¯åŠ¨è‡ªåŠ¨æ‰§è¡Œ
        start() {
          this.isAutoPlay = true;
          this.doAutoPlay();
        },
        //æš‚åœè‡ªåŠ¨æ‰§è¡Œ
        stop() {
          this.isAutoPlay = false;
        },
        // è‡ªåŠ¨æ‰§è¡Œï¼Œå¹²æ´»çš„
        doAutoPlay() {
          if (!this.isAutoPlay) return;
          setTimeout(() => {
            this.play();
            this.doAutoPlay();
          }, (this.speed));
        }
      },
      created: function () { this.initSortItems() },
    });
  </script>

</body>


</html>