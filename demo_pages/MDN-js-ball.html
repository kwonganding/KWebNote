<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSÊòüÁ©∫ÂΩ©ÁêÉÂ§ßÊàò</title>
    <meta name="description" content="Ê∑òÂÆùÁΩë - ‰∫öÊ¥≤ËæÉÂ§ßÁöÑÁΩë‰∏ä‰∫§ÊòìÂπ≥Âè∞ÔºåÊèê‰æõÂêÑÁ±ªÊúçÈ•∞„ÄÅÁæéÂÆπ‚Ä¶ ">
    <meta name="description" content="ÂèØÂèå‰∫∫ÂØπÊàòÁöÑÊ∏∏ÊàèÔºö‰∏Ä‰∏™‰∫∫‰∏Ä‰∏™ÂúàÔºåËøõÂÖ•ÂúàÁöÑÁêÉ‰ºöË¢´ÂêÉÊéâËé∑ÂæóÁßØÂàÜÔºåÂúà‰ºöÂ¢ûÂ§ßÔºõ‰∏Ä‰∏™ÂúàÊñπÂêëÊéßÂà∂‰ΩçÁΩÆÁßªÂä®ÔºåÂè¶‰∏Ä‰∏™ÂúàÈº†Ê†áÁÇπÂáªÊéßÂà∂‰ΩçÁΩÆ">
    <style>
        body {
            margin: 0px;
            background-color: black;
            color: rgb(29, 219, 29);
            overflow: hidden;
        }

        .header {
            position: absolute;
            top: -5px;
            width: 300px;
            left: calc(50% - 150px);
            text-align: center;
            line-height: 1.5em;
        }

        .header h1 {
            text-shadow: 1px 1px 4px rgb(204, 226, 191);
        }

        #score1 {
            color: rgb(248, 134, 41);
            font-size: 1.2em;
            padding: 0px 10px;
        }

        #score2 {
            color: rgb(67, 67, 250);
            font-size: 1.2em;
            padding: 0px 10px;
        }

        .footer {
            position: absolute;
            bottom: 60px;
            text-align: center;
            width: 100%;
            height: 1em;
        }

        .footer button {
            width: 50px;
            font-size: 20px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            border: none;
            background-color: aquamarine;
            opacity: 0.5;
        }

        .footer button:hover {
            background-color: white;
            opacity: 1;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ÊòüÁ©∫ÂΩ©ÁêÉÂ§ßÊàò</h1>
        <p><span id="score1">Â∞èÂç§ËõãÔºö0</span> | <span id="score2">ÂàÜÊï∞2Ôºö0</span></p>
    </div>
    <canvas></canvas>
    <div class="footer">
        <button onclick="addBall();" title="Ê∑ªÂä†ÂΩ©ÁêÉÔºå‰∏ÄÊ¨°50ÂèØÂ§öÊ¨°Ê∑ªÂä†">‚ûï</button>
        <button onclick="start();" title="ÂºÄÂßãÊ∏∏Êàè">‚ñ∂Ô∏è</button>
        <button onclick="stop();" title="ÊöÇÂÅúÊ∏∏Êàè">üî¥</button>
        <button onclick="restAll();" title="Ê∏ÖÁ©∫ÈáçÁΩÆÊ∏∏Êàè">üóëÔ∏è</button>
    </div>
</body>
<script>
    const ca = document.querySelector("canvas");
    const ctx = ca.getContext('2d');
    ctx.globalAlpha
    const fw = ca.width = window.innerWidth;
    const fh = ca.height = window.innerHeight;
    let balls = [];
    const ballN = 50;
    const ballMax = 2000;
    let isPlay = false;

    //#region  User
    class User {
        constructor() {
            this.pre = "";
            this.evil = null;
        }
        updateScore() {
            this.pre.innerText = "ÂàÜÊï∞Ôºö" + this.evil.eatTotal;
        }
    }
    User.draw = function () {
        User.users.forEach((user) => {
            user.evil.draw();
        })
    }
    User.updateScore = function (evil) {
        User.users.forEach((user) => {
            if (user.evil === evil) {
                user.updateScore();
            }
        })
    }
    User.loop = function () {
        User.users.forEach((user) => {
            user.evil.draw();
            user.evil.checkBounds();
            user.evil.eat();
        })
    }
    User.clear = function () {
        User.users.forEach((user) => {
            user.evil.eatTotal = 0;
            user.updateScore();
        })
    }
    //#endregion

    //ÂàùÂßãÂåñÁî®Êà∑
    User.user1 = new User();
    User.user2 = new User();
    User.users = new Set([User.user1, User.user2]);
    User.user1.pre = document.getElementById("score1");
    User.user2.pre = document.getElementById("score2");
    //add user
    User.user1.evil = new EvilCircle(random(0, fw), random(100, fh), 10, 10, 'rgb(248, 134, 41)', 40);
    User.user2.evil = new EvilCircle(random(0, fw), random(100, fh), 10, 10, 'rgb(67, 67, 250)', 30);
    User.draw();

    //ÊéßÂà∂
    function start() {
        if (isPlay)
            return;
        isPlay = true;
        loop();
    }
    function stop() {
        isPlay = false;
    }
    function restAll() {
        balls.splice(0, balls.length);
        ctx.clearRect(0, 0, fw, fh);
        loop();
        User.clear();
    }
    function addBall() {
        if (balls.length >= ballMax)
            return;
        for (let i = 0; i < ballN; i++) {
            let size = random(5, 20);
            let ball = new Ball(random(0 + size, fw - size), random(0 + size, fh - size), random(-5, 5), random(-5, 5), randomColor(), size);
            balls.push(ball);
            ball.draw();
        }
        User.draw();
    }

    function loop() {
        ctx.fillStyle = 'rgb(0,0,0,0.3)';
        ctx.fillRect(0, 0, fw, fh);
        for (let i = 0; i < balls.length; i++) {
            if (!balls[i].exist)
                continue;
            balls[i].draw();
            balls[i].update();
            balls[i].collisionDetect();
        }
        if (isPlay) {
            User.loop();
            requestAnimationFrame(loop);
        }
    }

    window.onkeydown = (e) => {
        if (!isPlay)
            return;
        switch (e.key) {
            case 'ArrowUp':
            case 'W':
            case 'w':
                User.user1.evil.y -= User.user1.evil.vely;
                break;
            case 'ArrowDown':
            case 'S':
            case 's':
                User.user1.evil.y += User.user1.evil.vely;
                break;
            case 'ArrowLeft':
            case 'A':
            case 'a':
                User.user1.evil.x -= User.user1.evil.velx;
                break;
            case 'ArrowRight':
            case 'D':
            case 'd':
                User.user1.evil.x += User.user1.evil.velx;
                break;
        }
    }
    ca.onmousedown = (e) => {
        if (!isPlay)
            return;
        User.user2.evil.x = e.offsetX;
        User.user2.evil.y = e.offsetY;
    }

    //ÂÆö‰πâÂõæÂΩ¢
    function Shape(x, y, velx, vely, color, size) {
        this.x = x;
        this.y = y;
        this.velx = velx; //x„ÄÅyÊñπÂêëÁöÑÈÄüÂ∫¶
        this.vely = vely;
        this.exist = true; //ÊòØÂê¶Â≠òÂú®ÔºåÊ†áËÆ∞Ë¢´ÂêÉÊéâ
        this.color = color;
        this.size = size;
    }
    //ballÔºöÂùêÊ†á„ÄÅÈÄüÂ∫¶ÔºåÈ¢úËâ≤„ÄÅÂ§ßÂ∞è
    function Ball(x, y, velx, vely, color, size) {
        Shape.call(this, x, y, velx, vely, color, size);
        this.collisionBalls = new Map();
        this.draw = function () {
            ctx.beginPath();
            ctx.fillStyle = this.color;
            ctx.arc(this.x, this.y, this.size, 0, 2 * Math.PI);
            ctx.fill();
        };
        this.update = function () {
            //Âõõ‰∏™ËæπÁöÑÁ¢∞ÊíûÊ£ÄÊµãÔºåËææÂà∞ËæπÁºòÔºåÈÄüÂ∫¶ÊñπÂêëÂèçËΩ¨
            if ((this.x + this.size) >= fw) {
                this.velx = -(this.velx);
            }
            if ((this.x - this.size) <= 0) {
                this.velx = -(this.velx);
            }
            if ((this.y + this.size) >= fh) {
                this.vely = -(this.vely);
            }
            if ((this.y - this.size) <= 0) {
                this.vely = -(this.vely);
            }
            //ÁßªÂä®
            this.x += this.velx;
            this.y += this.vely;
        }
        this.collisionDetect = function () {
            // collision /k…ôÀàl…™ í(…ô)n/ Á¢∞Êíû
            // ‰∏éÊØè‰∏™ÁêÉÁöÑ‰ΩçÁΩÆËøõË°åÊ£ÄÊµãÔºåÊ∂àÈô§Èó™ÁÉÅ
            for (let i = 0; i < balls.length; i++) {
                if (this === balls[i] || !balls[i].exist) {
                    continue;
                }
                //Áî®‰∏âËßíÂáΩÊï∞ËÆ°ÁÆóË∑ùÁ¶ª
                const dx = this.x - balls[i].x;
                const dy = this.y - balls[i].y;
                const d = Math.sqrt(dx * dx + dy * dy);
                //Á¨¨‰∏ÄÊ¨°Â∞èÈ≠öÊ∑ªÂä†ÔºåÁ¨¨‰∏ÄÊ¨°Â§ßÈ≠öÁßªÈô§
                if (d < (this.size + balls[i].size) && !this.collisionBalls.has(balls[i])) {
                    this.collisionBalls.set(balls[i], d);
                    balls[i].color = this.color = randomColor();
                }
                else if (d >= (this.size + balls[i].size)) {
                    this.collisionBalls.delete(balls[i]);
                }
            }
        }
    }
    //ÊÅ∂È≠îÁêÉ
    function EvilCircle(x, y, velx, vely, color, size) {
        //Evil /ÀàiÀêvl/ÊÅ∂È≠î    Circle/Ààs…úÀêk(…ô)l/
        Shape.call(this, x, y, velx, vely, color, size);
        this.eatTotal = 0;
        this.draw = function () {
            ctx.beginPath();
            ctx.lineWidth = 5;
            ctx.strokeStyle = this.color;
            let size = this.size + this.eatTotal / 2;
            ctx.arc(this.x, this.y, size, 0, 2 * Math.PI);
            ctx.stroke();
        }
        this.checkBounds = function () {
            //Âõõ‰∏™ËæπÁöÑÁ¢∞ÊíûÊ£ÄÊµãÔºåËææÂà∞ËæπÁºòÔºåÈÄüÂ∫¶ÊñπÂêëÂèçËΩ¨
            if ((this.x + this.size) >= fw) {
                this.x = fw - this.size;
            }
            if ((this.x - this.size) <= 0) {
                this.x = this.size;
            }
            if ((this.y + this.size) >= fh) {
                this.y = fh - this.size;
            }
            if ((this.y - this.size) <= 0) {
                this.y = this.size;
            }
        }
        this.eat = function () {
            //ÂêÉÂ∞èÁêÉ
            for (let i = 0; i < balls.length; i++) {
                if (!balls[i].exist) {
                    continue;
                }
                //Áî®‰∏âËßíÂáΩÊï∞ËÆ°ÁÆóË∑ùÁ¶ª
                const dx = Math.abs(this.x - balls[i].x);
                const dy = Math.abs(this.y - balls[i].y);
                const d = Math.sqrt(dx * dx + dy * dy);
                //Á¨¨‰∏ÄÊ¨°Â∞èÈ≠öÊ∑ªÂä†ÔºåÁ¨¨‰∏ÄÊ¨°Â§ßÈ≠öÁßªÈô§
                if (d < (this.size + balls[i].size)) {
                    balls[i].exist = false;
                    User.updateScore(this);
                    this.eatTotal++;
                }
            }
        }
    }

    //Ëøô‰∏§Âè•‰ª£Á†ÅËøòÊúâÂøÖË¶ÅÂêóÔºüBallÈáåÈù¢Áî®callË∞ÉÁî®ShapeÊûÑÈÄ†ÂáΩÊï∞Â∞±ÊòØÂÆûÁé∞ÁªßÊâø‰∫Ü
    // Ball.prototype = Object.create(Shape.prototype);
    // Ball.prototype.constructor = Ball;

    //Â∑•ÂÖ∑ÂáΩÊï∞ÔºöÈöèÊú∫Êï∞
    function random(min, max) {
        return Math.floor(Math.random() * (max - min) + min);
    }

    function randomColor() {
        return `rgb(${random(0, 255)},${random(0, 255)},${random(0, 255)})`
    }

</script>

</html>